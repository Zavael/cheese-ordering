/*
Created: 13. 7. 2020
Modified: 13. 7. 2020
Model: PostgreSQL 10
Database: PostgreSQL 10
*/


-- Drop indexes section -------------------------------------------------

DROP INDEX IF EXISTS "IX_Relationship2"
;

DROP INDEX IF EXISTS "IX_Relationship7"
;

DROP INDEX IF EXISTS "IX_Relationship4"
;

DROP INDEX IF EXISTS "IX_Relationship6"
;

DROP INDEX IF EXISTS "IX_Relationship8"
;

-- Drop tables section ---------------------------------------------------

DROP TABLE IF EXISTS "ordered_items"
;
DROP TABLE IF EXISTS "orders"
;
DROP TABLE IF EXISTS "priced_items"
;
DROP TABLE IF EXISTS "items"
;
DROP TABLE IF EXISTS "customers"
;

DROP SCHEMA IF EXISTS "public" CASCADE;
CREATE SCHEMA "public";
-- Create tables section -------------------------------------------------

-- Table customers

CREATE TABLE "customers"
(
  "id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "first_name" Text,
  "last_name" Text
)
WITH (
  autovacuum_enabled=true)
;
-- Table items

CREATE TABLE "items"
(
  "id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "name" Text
)
WITH (
  autovacuum_enabled=true)
;
-- Table priced_items

CREATE TABLE "priced_items"
(
  "id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "valid_from" Date,
  "valid_to" Date,
  "value" Double precision,
  "item_id" integer REFERENCES "items" ("id") ON DELETE CASCADE ON UPDATE NO ACTION
)
WITH (
  autovacuum_enabled=true)
;

CREATE INDEX "IX_Relationship2" ON "priced_items" ("item_id")
;
-- Table orders

CREATE TABLE "orders"
(
  "id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "payment_status" Boolean,
  "date" Date,
  "total_price" integer,
  "customer_id" integer REFERENCES "customers" ("id") ON DELETE CASCADE ON UPDATE NO ACTION
)
WITH (
  autovacuum_enabled=true)
;

CREATE INDEX "IX_Relationship7" ON "orders" ("customer_id")
;
-- Table ordered_items

CREATE TABLE "ordered_items"
(
  "id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  "amount" integer,
  "item_id" integer REFERENCES "items" ("id") ON DELETE SET NULL ON UPDATE NO ACTION,
  "order_id" integer REFERENCES "orders" ("id") ON DELETE CASCADE ON UPDATE NO ACTION
)
WITH (
  autovacuum_enabled=true)
;

CREATE INDEX "IX_Relationship4" ON "ordered_items" ("item_id")
;
CREATE INDEX "IX_Relationship6" ON "ordered_items" ("order_id")
;




